-- -*- coding: utf-8 -*-
--   --------------------------------------------------
--   Generated by Jean-Félix BENITEZ
--   Created On : mardi, 8 août, 2017
--   DBMS       : Oracle
--   --------------------------------------------------

-- USE DATABASE Oracle;


--  Drop Tables from previous version
DROP TABLE AlimentCompose CASCADE CONSTRAINTS;
DROP TABLE AlimentConstitue CASCADE CONSTRAINTS;
DROP TABLE Dejeuner CASCADE CONSTRAINTS;
DROP TABLE Diner CASCADE CONSTRAINTS;
DROP TABLE Familles CASCADE CONSTRAINTS;
DROP TABLE Formes CASCADE CONSTRAINTS;
DROP TABLE Natures CASCADE CONSTRAINTS;
DROP TABLE PetitDejeuner CASCADE CONSTRAINTS;
DROP TABLE Subir CASCADE CONSTRAINTS;
DROP TABLE ALIMENTSBASE CASCADE CONSTRAINTS;
DROP TABLE PROFILPATIENT CASCADE CONSTRAINTS;
DROP TABLE Textures CASCADE CONSTRAINTS;

--  Drop Tables, Stored Procedures and Views
DROP TABLE Affecter CASCADE CONSTRAINTS;
DROP TABLE Aliment CASCADE CONSTRAINTS;
DROP TABLE ComposantIngredient CASCADE CONSTRAINTS;
DROP TABLE ComposantPlat CASCADE CONSTRAINTS;
DROP TABLE Constituer CASCADE CONSTRAINTS;
DROP TABLE Contrainte CASCADE CONSTRAINTS;
DROP TABLE DateProfilPatient CASCADE CONSTRAINTS;
DROP TABLE Dieteticien CASCADE CONSTRAINTS;
DROP TABLE ElementNutritif CASCADE CONSTRAINTS;
DROP TABLE Famille CASCADE CONSTRAINTS;
DROP TABLE Forme CASCADE CONSTRAINTS;
DROP TABLE GroupePatients CASCADE CONSTRAINTS;
DROP TABLE Ingredient CASCADE CONSTRAINTS;
DROP TABLE IngredientCompose CASCADE CONSTRAINTS;
DROP TABLE IngredientConstitue CASCADE CONSTRAINTS;
DROP TABLE Medecin CASCADE CONSTRAINTS;
DROP TABLE Menu CASCADE CONSTRAINTS;
DROP TABLE Patient CASCADE CONSTRAINTS;
DROP TABLE Plat CASCADE CONSTRAINTS;
DROP TABLE Repas CASCADE CONSTRAINTS;
DROP TABLE Sejour CASCADE CONSTRAINTS;
DROP TABLE Texture CASCADE CONSTRAINTS;

--  Create Tables
CREATE TABLE Affecter (
	groupePatientsID NUMBER NOT NULL,
	contrainteID NUMBER NOT NULL
);

CREATE TABLE Aliment (
	alimentID NUMBER NOT NULL,
	nom VARCHAR2(50),
	famille NUMBER,
	forme NUMBER,
	texture NUMBER
);

CREATE TABLE ComposantIngredient (
	ingredientID NUMBER NOT NULL,
	elementID NUMBER NOT NULL,
	teneur NUMBER
);

CREATE TABLE ComposantPlat (
	quantite NUMBER(8,2),
	unite VARCHAR2(50),
	platID NUMBER NOT NULL,
	alimentID NUMBER NOT NULL
);

CREATE TABLE Constituer (
	repasID NUMBER NOT NULL,
	platID NUMBER NOT NULL
);

CREATE TABLE Contrainte (
	contrainteID NUMBER NOT NULL,
	nature CHAR(2) CHECK (nature IN ('Al', 'CI', 'Ma')), -- Allergie, Contre Indication et Maladie
	nom VARCHAR2(50),
	famille NUMBER,
	forme NUMBER,
	texture NUMBER
);

CREATE TABLE DateProfilPatient (
	contrainteID NUMBER NOT NULL,
	dieteticienID NUMBER NOT NULL,
	medecinID NUMBER NOT NULL,
	patientID NUMBER NOT NULL,
	dateProfil Date,
	dateValidation Date
);

CREATE TABLE Dieteticien (
	dieteticienID NUMBER NOT NULL,
	nom VARCHAR2(50),
	prenom VARCHAR2(50)
);

CREATE TABLE ElementNutritif (
	elementID NUMBER NOT NULL,
	element VARCHAR2(50)
);

CREATE TABLE Famille (
	nom VARCHAR2(50),
	id NUMBER NOT NULL
);

CREATE TABLE Forme (
	nom VARCHAR2(50),
	id NUMBER NOT NULL
);

CREATE TABLE GroupePatients (
	groupePatientsID NUMBER NOT NULL,
	nom VARCHAR2(50)
);

CREATE TABLE Ingredient (
	nom VARCHAR2(50),
	id NUMBER NOT NULL
);

CREATE TABLE IngredientCompose (
	alimentID NUMBER NOT NULL,
	ingredientID NUMBER NOT NULL
);

CREATE TABLE IngredientConstitue (
	ingredientID NUMBER NOT NULL,
	contrainteID NUMBER NOT NULL
);

CREATE TABLE Medecin (
	medecinID NUMBER NOT NULL,
	nom VARCHAR2(50),
	prenom VARCHAR2(50)
);

CREATE TABLE Menu (
	repasID NUMBER NOT NULL,
	groupePatientsID NUMBER NOT NULL,
	dateMenu Date
);

CREATE TABLE Patient (
	age NUMBER,
	chambre NUMBER,
	nom VARCHAR2(50),
	patientID NUMBER NOT NULL,
	poids NUMBER,
	prenom VARCHAR2(50),
	service VARCHAR2(50),
	sexe CHAR(1) CHECK (sexe IN ('H', 'F')),
	taille NUMBER,
	formeGroupePatient NUMBER NOT NULL
);

CREATE TABLE Plat (
	categorie VARCHAR2(50),
	minMax CHAR(3) CHECK (minMax IN ('Min', 'Max')),
	nombreService NUMBER,
	nom VARCHAR2(50),
	periode NUMBER,
	platID NUMBER NOT NULL
);

CREATE TABLE Repas (
	repasID NUMBER NOT NULL,
	typeRepas CHAR(3) CHECK (typeRepas IN ('PDJ', 'DEJ', 'DIN')) -- Petit Déjeuner, Déjeuner et Diner
);

CREATE TABLE Sejour (
	sejourID NUMBER NOT NULL,
	dateArivee Date,
	dateDepart Date
);

CREATE TABLE Texture (
	nom VARCHAR2(50),
	id NUMBER NOT NULL
);

--  Create Primary Key Constraints
ALTER TABLE Affecter ADD CONSTRAINT PK_Affecter PRIMARY KEY (groupePatientsID, contrainteID);

ALTER TABLE Aliment ADD CONSTRAINT PK_Aliment PRIMARY KEY (alimentID);

ALTER TABLE ComposantIngredient ADD CONSTRAINT PK_ComposantIngredient PRIMARY KEY (ingredientID, elementID);

ALTER TABLE ComposantPlat ADD CONSTRAINT PK_ComposantPlat PRIMARY KEY (platID, alimentID);

ALTER TABLE Constituer ADD CONSTRAINT PK_Constituer PRIMARY KEY (repasID, platID);

ALTER TABLE Contrainte ADD CONSTRAINT PK_Contrainte PRIMARY KEY (contrainteID);

ALTER TABLE DateProfilPatient ADD CONSTRAINT PK_DateProfilPatient PRIMARY KEY (contrainteID, dieteticienID, medecinID, patientID);

ALTER TABLE Dieteticien ADD CONSTRAINT PK_Dieteticien PRIMARY KEY (dieteticienID);

ALTER TABLE ElementNutritif ADD CONSTRAINT PK_ElementNutritif PRIMARY KEY (elementID);

ALTER TABLE Famille ADD CONSTRAINT PK_Famille PRIMARY KEY (id);

ALTER TABLE Forme ADD CONSTRAINT PK_Forme PRIMARY KEY (id);

ALTER TABLE GroupePatients ADD CONSTRAINT PK_GroupePatients PRIMARY KEY (groupePatientsID);

ALTER TABLE Ingredient ADD CONSTRAINT PK_Ingredient PRIMARY KEY (id);

ALTER TABLE IngredientCompose ADD CONSTRAINT PK_IngredientCompose PRIMARY KEY (alimentID, ingredientID);

ALTER TABLE IngredientConstitue ADD CONSTRAINT PK_IngredientConstitue PRIMARY KEY (contrainteID, ingredientID);

ALTER TABLE Medecin ADD CONSTRAINT PK_Medecin PRIMARY KEY (medecinID);

ALTER TABLE Menu ADD CONSTRAINT PK_Menu PRIMARY KEY (repasID, groupePatientsID);

ALTER TABLE Patient ADD CONSTRAINT PK_Patient PRIMARY KEY (patientID);

ALTER TABLE Plat ADD CONSTRAINT PK_Plat PRIMARY KEY (platID);

ALTER TABLE Repas ADD CONSTRAINT PK_Repas PRIMARY KEY (repasID);

ALTER TABLE Sejour ADD CONSTRAINT PK_Sejour PRIMARY KEY (sejourID);

ALTER TABLE Texture ADD CONSTRAINT PK_Texture PRIMARY KEY (id);

--  Create Foreign Key Constraints
ALTER TABLE Affecter ADD CONSTRAINT FK_GroupePatients_Affecter
	FOREIGN KEY (groupePatientsID) REFERENCES GroupePatients (groupePatientsID);

ALTER TABLE Affecter ADD CONSTRAINT FK_Contrainte_Affecter
	FOREIGN KEY (contrainteID) REFERENCES Contrainte (contrainteID);

ALTER TABLE Aliment ADD CONSTRAINT FK_Famille_Aliment
	FOREIGN KEY (famille) REFERENCES Famille (id);

ALTER TABLE Aliment ADD CONSTRAINT FK_Forme_Aliment
	FOREIGN KEY (forme) REFERENCES Forme (id);

ALTER TABLE Aliment ADD CONSTRAINT FK_Texture_Aliment
	FOREIGN KEY (texture) REFERENCES Texture (id);

ALTER TABLE ComposantIngredient ADD CONSTRAINT FK_Ingredient_CompIngredient
	FOREIGN KEY (ingredientID) REFERENCES Ingredient (id);

ALTER TABLE ComposantIngredient ADD CONSTRAINT FK_ElNutritif_CompIngredient
	FOREIGN KEY (elementID) REFERENCES ElementNutritif (elementID);

ALTER TABLE ComposantPlat ADD CONSTRAINT FK_Aliment_ComposantPlat
	FOREIGN KEY (alimentID) REFERENCES Aliment (alimentID);

ALTER TABLE ComposantPlat ADD CONSTRAINT FK_Plat_ComposantPlat
	FOREIGN KEY (platID) REFERENCES Plat (platID);

ALTER TABLE Constituer ADD CONSTRAINT FK_Repas_Constituer
	FOREIGN KEY (repasID) REFERENCES Repas (repasID);

ALTER TABLE Constituer ADD CONSTRAINT FK_Plat_Constituer
	FOREIGN KEY (platID) REFERENCES Plat (platID);

ALTER TABLE Contrainte ADD CONSTRAINT FK_Famille_Contrainte
	FOREIGN KEY (famille) REFERENCES Famille (id);

ALTER TABLE Contrainte ADD CONSTRAINT FK_Forme_Contrainte
	FOREIGN KEY (forme) REFERENCES Forme (id);

ALTER TABLE Contrainte ADD CONSTRAINT FK_Texture_Contrainte
	FOREIGN KEY (texture) REFERENCES Texture (id);

ALTER TABLE DateProfilPatient ADD CONSTRAINT FK_Contraint_DateProfilPatient
	FOREIGN KEY (contrainteID) REFERENCES Contrainte (contrainteID);

ALTER TABLE DateProfilPatient ADD CONSTRAINT FK_Diet_DateProfilPatient
	FOREIGN KEY (dieteticienID) REFERENCES Dieteticien (dieteticienID);

ALTER TABLE DateProfilPatient ADD CONSTRAINT FK_Medecin_DateProfilPatient
	FOREIGN KEY (medecinID) REFERENCES Medecin (medecinID);

ALTER TABLE DateProfilPatient ADD CONSTRAINT FK_Patient_DateProfilPatient
	FOREIGN KEY (patientID) REFERENCES Patient (patientID);

ALTER TABLE IngredientCompose ADD CONSTRAINT FK_Aliment_IngredientCompose
	FOREIGN KEY (alimentID) REFERENCES Aliment (alimentID);

ALTER TABLE IngredientCompose ADD CONSTRAINT FK_Ing_IngredientCompose
	FOREIGN KEY (ingredientID) REFERENCES Ingredient (id);

ALTER TABLE IngredientConstitue ADD CONSTRAINT FK_Ingredient_Constitue
	FOREIGN KEY (ingredientID) REFERENCES Ingredient (id);

ALTER TABLE IngredientConstitue ADD CONSTRAINT FK_Contraint_IngConstitue
	FOREIGN KEY (contrainteID) REFERENCES Contrainte (contrainteID);

ALTER TABLE Menu ADD CONSTRAINT FK_Repas_Menu
	FOREIGN KEY (repasID) REFERENCES Repas (repasID);

ALTER TABLE Menu ADD CONSTRAINT FK_GroupePatients_Menu
	FOREIGN KEY (groupePatientsID) REFERENCES GroupePatients (groupePatientsID);

ALTER TABLE Patient ADD CONSTRAINT FK_FormerGroupePatients
	FOREIGN KEY (formeGroupePatient) REFERENCES GroupePatients (groupePatientsID);
