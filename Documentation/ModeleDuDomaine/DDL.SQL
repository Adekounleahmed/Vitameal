--   --------------------------------------------------
--   Generated by Enterprise Architect Version 6.5.805
--   Created On : vendredi, 14 juillet, 2017
--   DBMS       : Oracle
--   --------------------------------------------------

-- USE DATABASE Oracle ;


--  Drop Tables, Stored Procedures and Views
DROP TABLE Natures CASCADE CONSTRAINTS;
DROP TABLE Affecter CASCADE CONSTRAINTS ;
DROP TABLE AlimentCompose CASCADE CONSTRAINTS ;
DROP TABLE AlimentConstitue CASCADE CONSTRAINTS ;
DROP TABLE AlimentsBase CASCADE CONSTRAINTS ;
DROP TABLE ComposantPlat CASCADE CONSTRAINTS ;
DROP TABLE Constituer CASCADE CONSTRAINTS ;
DROP TABLE Contrainte CASCADE CONSTRAINTS ;
DROP TABLE Dejeuner CASCADE CONSTRAINTS ;
DROP TABLE Diner CASCADE CONSTRAINTS ;
DROP TABLE Familles CASCADE CONSTRAINTS ;
DROP TABLE Formes CASCADE CONSTRAINTS ;
DROP TABLE GroupePatients CASCADE CONSTRAINTS ;
DROP TABLE Ingredient CASCADE CONSTRAINTS ;
DROP TABLE Menu CASCADE CONSTRAINTS ;
DROP TABLE Patient CASCADE CONSTRAINTS ;
DROP TABLE PetitDejeuner CASCADE CONSTRAINTS ;
DROP TABLE Plat CASCADE CONSTRAINTS ;
DROP TABLE Subir CASCADE CONSTRAINTS ;
DROP TABLE Textures CASCADE CONSTRAINTS ;

--  Create Tables
CREATE TABLE Natures (
	nature VARCHAR2(22),
        naturesID NUMBER
);

CREATE TABLE Affecter (
	groupePatientsID NUMBER,
	contrainteID NUMBER
) ;

CREATE TABLE AlimentCompose (
	alimentsBaseID NUMBER,
	ingredientID NUMBER
) ;

CREATE TABLE AlimentConstitue (
	alimentsBaseID NUMBER,
	contrainteID NUMBER
) ;

CREATE TABLE AlimentsBase (
	alimentBase VARCHAR2(50),
        alimentsBaseID NUMBER
) ;

CREATE TABLE ComposantPlat (
	quantite NUMBER(8,2),
	unite VARCHAR2(50),
	platID NUMBER NOT NULL,
	ingredientID NUMBER NOT NULL
) ;

CREATE TABLE Constituer (
	menuID NUMBER,
	platID NUMBER
) ;

CREATE TABLE Contrainte (
	contrainteID NUMBER NOT NULL,
	nature NUMBER,
	nom VARCHAR2(50),
	famille NUMBER,
	forme NUMBER,
	texture NUMBER
) ;

CREATE TABLE Dejeuner (
	dejeunerID NUMBER NOT NULL
) ;

CREATE TABLE Diner (
	dinerID NUMBER NOT NULL
) ;

CREATE TABLE Familles (
	famille VARCHAR2(50),
        famillesID NUMBER
) ;

CREATE TABLE Formes (
	forme VARCHAR2(50),
        formesID NUMBER
) ;

CREATE TABLE GroupePatients (
	groupePatientsID NUMBER NOT NULL,
	nom VARCHAR2(50)
) ;

CREATE TABLE Ingredient (
	ingredientID NUMBER NOT NULL,
	nom VARCHAR2(50),
	famille NUMBER,
	forme NUMBER,
	texture NUMBER
) ;

CREATE TABLE Menu (
	dateMenu Date,
	menuID NUMBER NOT NULL,
	estConsParGP NUMBER
) ;

CREATE TABLE Patient (
	age NUMBER,
	chambre NUMBER,
	nom VARCHAR2(50),
	patientID NUMBER NOT NULL,
	poids NUMBER,
	prenom VARCHAR2(50),
	service VARCHAR2(50),
	sexe VARCHAR2(1) CHECK (sexe IN ('H', 'F')),
	taille NUMBER,
	formeGroupePatient NUMBER
) ;

CREATE TABLE PetitDejeuner (
	petitDejeunerID NUMBER NOT NULL
) ;

CREATE TABLE Plat (
	categorie VARCHAR2(50),
	minMax VARCHAR2(3) CHECK (minMax IN ('Min', 'Max')),
	nbServices NUMBER,
	nom VARCHAR2(50),
	periode NUMBER,
	platID NUMBER NOT NULL
) ;

CREATE TABLE Subir (
	patientID NUMBER,
	contrainteID NUMBER
) ;

CREATE TABLE Textures (
	texture VARCHAR2(50),
        texturesID NUMBER
) ;

--  Create Primary Key Constraints
ALTER TABLE Natures ADD CONSTRAINT PK_Natures PRIMARY KEY (naturesID);

ALTER TABLE AlimentsBase ADD CONSTRAINT PK_AlimentsBase
	PRIMARY KEY (alimentsBaseID) ;

ALTER TABLE ComposantPlat ADD CONSTRAINT PK_ComposantPlat
	PRIMARY KEY (platID, ingredientID) ;

ALTER TABLE Contrainte ADD CONSTRAINT PK_Contrainte
	PRIMARY KEY (contrainteID) ;

ALTER TABLE Dejeuner ADD CONSTRAINT PK_Dejeuner
	PRIMARY KEY (dejeunerID) ;

ALTER TABLE Diner ADD CONSTRAINT PK_Diner
	PRIMARY KEY (dinerID) ;

ALTER TABLE Familles ADD CONSTRAINT PK_Familles
	PRIMARY KEY (famillesID) ;

ALTER TABLE Formes ADD CONSTRAINT PK_Formes
	PRIMARY KEY (formesID) ;

ALTER TABLE GroupePatients ADD CONSTRAINT PK_GroupePatients
	PRIMARY KEY (groupePatientsID) ;

ALTER TABLE Ingredient ADD CONSTRAINT PK_Ingredient
	PRIMARY KEY (ingredientID) ;

ALTER TABLE Menu ADD CONSTRAINT PK_Menu
	PRIMARY KEY (menuID) ;

ALTER TABLE Patient ADD CONSTRAINT PK_Patient
	PRIMARY KEY (patientID) ;

ALTER TABLE PetitDejeuner ADD CONSTRAINT PK_PetitDejeuner
	PRIMARY KEY (petitDejeunerID) ;

ALTER TABLE Plat ADD CONSTRAINT PK_Plat
	PRIMARY KEY (platID) ;

ALTER TABLE Textures ADD CONSTRAINT PK_Textures
	PRIMARY KEY (texturesID) ;



--  Create Foreign Key Constraints
ALTER TABLE Contrainte ADD CONSTRAINT FK_Natures FOREIGN KEY (nature) REFERENCES Natures (naturesID);

ALTER TABLE Affecter ADD CONSTRAINT FK_GroupePatients_Affecter
	FOREIGN KEY (groupePatientsID) REFERENCES GroupePatients (groupePatientsID) ;

ALTER TABLE Affecter ADD CONSTRAINT FK_Contrainte_Affecter
	FOREIGN KEY (contrainteID) REFERENCES Contrainte (contrainteID) ;

ALTER TABLE AlimentCompose ADD CONSTRAINT FK_AlimentsBase_AlimentCompose
	FOREIGN KEY (alimentsBaseID) REFERENCES AlimentsBase (alimentsBaseID) ;

ALTER TABLE AlimentCompose ADD CONSTRAINT FK_Ingredient_AlimentCompose
	FOREIGN KEY (ingredientID) REFERENCES Ingredient (ingredientID) ;

ALTER TABLE AlimentConstitue ADD CONSTRAINT FK_AlimentsBase_Constitue
	FOREIGN KEY (alimentsBaseID) REFERENCES AlimentsBase (alimentsBaseID) ;

ALTER TABLE AlimentConstitue ADD CONSTRAINT FK_Contrainte_AlimentConstitue
	FOREIGN KEY (contrainteID) REFERENCES Contrainte (contrainteID) ;

ALTER TABLE ComposantPlat ADD CONSTRAINT FK_ComposantPlat_Ingredient
	FOREIGN KEY (ingredientID) REFERENCES Ingredient (ingredientID) ;

ALTER TABLE ComposantPlat ADD CONSTRAINT FK_ComposantPlat_Plat
	FOREIGN KEY (platID) REFERENCES Plat (platID) ;

ALTER TABLE Constituer ADD CONSTRAINT FK_Menu_Constituer
	FOREIGN KEY (menuID) REFERENCES Menu (menuID) ;

ALTER TABLE Constituer ADD CONSTRAINT FK_Plat_Constituer
	FOREIGN KEY (platID) REFERENCES Plat (platID) ;

ALTER TABLE Contrainte ADD CONSTRAINT FK_famille_Contrainte
	FOREIGN KEY (famille) REFERENCES Familles (famillesID) ;

ALTER TABLE Contrainte ADD CONSTRAINT FK_forme_Contrainte
	FOREIGN KEY (forme) REFERENCES Formes (formesID) ;

ALTER TABLE Contrainte ADD CONSTRAINT FK_texture_Contrainte
	FOREIGN KEY (texture) REFERENCES Textures (texturesID) ;

ALTER TABLE Dejeuner ADD CONSTRAINT FK_Dejeuner_Menu
	FOREIGN KEY (dejeunerID) REFERENCES Menu (menuID) ;

ALTER TABLE Diner ADD CONSTRAINT FK_Diner_Menu
	FOREIGN KEY (dinerID) REFERENCES Menu (menuID) ;

ALTER TABLE Ingredient ADD CONSTRAINT FK_famille_Ingredient
	FOREIGN KEY (famille) REFERENCES Familles (famillesID) ;

ALTER TABLE Ingredient ADD CONSTRAINT FK_forme_Ingredient
	FOREIGN KEY (forme) REFERENCES Formes (formesID) ;

ALTER TABLE Ingredient ADD CONSTRAINT FK_texture_Ingredient
	FOREIGN KEY (texture) REFERENCES Textures (texturesID) ;

ALTER TABLE Menu ADD CONSTRAINT FK_Consommer_Menu
	FOREIGN KEY (estConsParGP) REFERENCES GroupePatients (groupePatientsID) ;

ALTER TABLE Patient ADD CONSTRAINT FK_FormerPatient
	FOREIGN KEY (formeGroupePatient) REFERENCES GroupePatients (groupePatientsID) ;

ALTER TABLE PetitDejeuner ADD CONSTRAINT FK_PetitDejeuner_Menu
	FOREIGN KEY (petitDejeunerID) REFERENCES Menu (menuID) ;

ALTER TABLE Subir ADD CONSTRAINT FK_Patient_Subir
	FOREIGN KEY (patientID) REFERENCES Patient (patientID) ;

ALTER TABLE Subir ADD CONSTRAINT FK_Contrainte_Subir
	FOREIGN KEY (contrainteID) REFERENCES Contrainte (contrainteID) ;
